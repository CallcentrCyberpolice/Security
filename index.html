<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referral System</title>
</head>
<body>
    <h1>Вітаємо в нашому веб-додатку!</h1>
    <p>Ваш Telegram ID: <span id="userId"></span></p>
    <p>Ваше реферальне посилання:</p>
    <p><a id="refLink" href="">https://t.me/YourBotUsername?start=</a></p>
    <p>Запрошено користувачів: <span id="referralCount">0</span></p>

    <h2>Ваші реферали:</h2>
    <ul id="referralList"></ul>

    <script>
        // Отримання ID користувача з URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('start');
        const refLink = document.getElementById('refLink');
        const userIdElement = document.getElementById('userId');
        const referralCountElement = document.getElementById('referralCount');
        const referralListElement = document.getElementById('referralList');

        // Встановлення ID користувача та реферального посилання
        userIdElement.textContent = userId;
        refLink.href = `https://t.me/YourBotUsername?start=${userId}`;

        // Перевірка в localStorage, чи користувач вже має рефералів
        let referralData = JSON.parse(localStorage.getItem('referralData')) || {};

        // Якщо користувач вже є в localStorage, не додаємо його знову
        if (!referralData[userId]) {
            referralData[userId] = {
                referralCount: 0,
                referrals: []
            };
        }

        // Оновлення відображення рефералів
        referralCountElement.textContent = referralData[userId].referralCount;

        // Виведення списку рефералів
        referralData[userId].referrals.forEach(referral => {
            const listItem = document.createElement('li');
            listItem.textContent = `ID: ${referral.id}, Username: ${referral.username}`;
            referralListElement.appendChild(listItem);
        });

        // Функція для додавання реферала
        function addReferral(referralId, referralUsername) {
            if (!referralData[referralId]) {
                referralData[referralId] = {
                    referralCount: 0,
                    referrals: []
                };
            }

            referralData[referralId].referrals.push({ id: referralId, username: referralUsername });
            referralData[referralId].referralCount++;
            localStorage.setItem('referralData', JSON.stringify(referralData));

            // Оновити кількість рефералів
            referralCountElement.textContent = referralData[userId].referralCount;

            // Додати новий елемент в список рефералів
            const listItem = document.createElement('li');
            listItem.textContent = `ID: ${referralId}, Username: ${referralUsername}`;
            referralListElement.appendChild(listItem);
        }

        // Імітація додавання реферала через посилання
        // (В реальності це має бути частиною бота або обробки через сервер)
        const mockReferralId = "new_user_123"; // ID нового користувача
        const mockReferralUsername = "new_user"; // Username нового користувача

        // Якщо користувач перейшов за посиланням з рефералом
        if (urlParams.has('start') && urlParams.get('start') !== userId) {
            addReferral(mockReferralId, mockReferralUsername);
        }
    </script>
</body>
</html>
